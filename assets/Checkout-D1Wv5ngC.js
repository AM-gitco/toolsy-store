import{j as e}from"./ui-BfOL7Pw6.js";import{H as s}from"./Header-CMjDRm3Z.js";import{r,f as a}from"./router-BXFWiZbc.js";import{a as t,b as o,c as n,C as c}from"./card-BQXi3xZY.js";import{B as i}from"./button-CmvG0lOO.js";import{I as l}from"./input-zfUHz5B2.js";import{L as d}from"./label-Dbe54ejA.js";import{A as m,a as u}from"./alert-DcEmRu5y.js";import{B as p}from"./badge-D8FtP9-V.js";import{t as x,u as h,s as j,a as f}from"./index-ud4XQfz4.js";import{C as g}from"./CurrencyDisplay-BCzKL-MM.js";import{C as N}from"./circle-check-big-DcnsFF-J.js";import{C as b}from"./copy-Bzr4DZ5N.js";import{E as _}from"./eye-off-BaTaP-XJ.js";import{E as y}from"./eye-B88tXCV3.js";import{M as v}from"./message-circle-DFpE3xjH.js";import{A as w}from"./arrow-left-Tt42aMK4.js";import{S as E}from"./shopping-cart-CxQptf5P.js";import{U as R}from"./user-Dr4rv7sj.js";import{M as C}from"./mail-DefGHly8.js";import{L as k}from"./loader-circle-Lrj5F5Df.js";import"./vendor-B5BPFqys.js";import"./toolsy-logo-C0HmbZOG.js";import"./CurrencySelector-Dp-scm2k.js";import"./select-CNwGciQv.js";import"./shield-BPn5TLBB.js";import"./supabase-DlLlES7-.js";import"./charts-AXPLIc8O.js";import"./motion-BU2psJSs.js";class S extends Error{code;status;context;timestamp;constructor(e,s){super(e),this.name="AppError",this.code=s?.code,this.status=s?.status,this.context=s?.context,this.timestamp=new Date}}const A={handle:(e,s)=>{const r=A.parseError(e);return A.showUserError(r,s),r},parseError:e=>e instanceof S?{message:e.message,code:e.code,status:e.status,context:e.context}:e instanceof Error?{message:e.message,code:"UNKNOWN_ERROR"}:"string"==typeof e?{message:e,code:"STRING_ERROR"}:e&&"object"==typeof e&&"message"in e?{message:e.message||"An unknown error occurred",code:e.code||"OBJECT_ERROR",status:e.status}:{message:"An unexpected error occurred",code:"UNKNOWN_ERROR"},showUserError:(e,s)=>{const{message:r,code:a,status:t}=e;let o=r,n="Error";switch(a){case"NETWORK_ERROR":o="Unable to connect to the server. Please check your internet connection.",n="Connection Error";break;case"VALIDATION_ERROR":o=r,n="Validation Error";break;case"AUTH_ERROR":o="Authentication failed. Please log in again.",n="Authentication Error";break;case"PERMISSION_ERROR":o="You don't have permission to perform this action.",n="Permission Denied";break;case"NOT_FOUND":o="The requested resource was not found.",n="Not Found";break;case"SERVER_ERROR":o="A server error occurred. Please try again later.",n="Server Error";break;default:404===t?(o="The requested resource was not found.",n="Not Found"):403===t?(o="You don't have permission to perform this action.",n="Permission Denied"):401===t?(o="Authentication failed. Please log in again.",n="Authentication Error"):t&&t>=500?(o="A server error occurred. Please try again later.",n="Server Error"):t&&t>=400&&(o=r||"A client error occurred.",n="Request Error")}"ErrorBoundary"!==s?.component&&x({title:n,description:o,variant:"destructive"})},create:{networkError:(e="Network error occurred")=>new S(e,{code:"NETWORK_ERROR"}),validationError:e=>new S(e,{code:"VALIDATION_ERROR"}),authError:(e="Authentication failed")=>new S(e,{code:"AUTH_ERROR"}),permissionError:(e="Permission denied")=>new S(e,{code:"PERMISSION_ERROR"}),notFound:(e="Resource not found")=>new S(e,{code:"NOT_FOUND",status:404}),serverError:(e="Server error occurred")=>new S(e,{code:"SERVER_ERROR",status:500})},wrap:(e,s)=>async(...r)=>{try{return await e(...r)}catch(a){return A.handle(a,s),null}},wrapSync:(e,s)=>(...r)=>{try{return e(...r)}catch(a){return A.handle(a,s),null}}},O=({items:s,onSuccess:a,onCancel:x})=>{const[f,S]=r.useState({user_name:"",user_email:""}),[O,P]=r.useState(!1),[T,I]=r.useState(""),[F,U]=r.useState(null),[D,$]=r.useState(!1),{toast:B}=h(),Y=(q={component:"CheckoutForm"},{handle:e=>A.handle(e,q),create:A.create,wrap:e=>A.wrap(e,q),wrapSync:e=>A.wrapSync(e,q)});var q;const H=s.reduce((e,s)=>e+s.price,0),L=e=>{navigator.clipboard.writeText(e),B({title:"Copied!",description:"Code copied to clipboard"})},W=()=>{if(!F)return;const e=F.product_codes.map(e=>`â€¢ ${e.product_code} (${e.product_name})`).join("\n"),s=`Hi! I just completed my purchase and here are my details:\n\n${F.is_returning_user?"Returning Customer":"New Customer"}\nUser Code: ${F.user_code}\nEmail: ${f.user_email}\n\nProduct Codes:\n${e}\n\nTotal: ${F.total_amount} ${F.currency}\n\nPlease approve my product codes and provide access. Thank you!`;window.open(`https://wa.me/923415685257?text=${encodeURIComponent(s)}`,"_blank")};return F?e.jsxs(t,{className:"max-w-2xl mx-auto",children:[e.jsxs(o,{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(N,{className:"w-8 h-8 text-green-600"})}),e.jsx(n,{className:"text-2xl text-green-600",children:F.is_returning_user?"Purchase Successful!":"Account Created!"}),e.jsx("p",{className:"text-muted-foreground",children:F.is_returning_user?"New product codes generated for your existing account":"Your account has been created successfully"})]}),e.jsxs(c,{className:"space-y-6",children:[e.jsxs("div",{className:"bg-primary/5 rounded-lg p-4 border border-primary/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(d,{className:"font-semibold",children:F.is_returning_user?"Your Existing User Code":"Your New User Code (Permanent)"}),e.jsx(p,{variant:F.is_returning_user?"secondary":"default",children:F.is_returning_user?"Existing":"New"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"bg-background px-3 py-2 rounded border flex-1 font-mono text-lg",children:F.user_code}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>L(F.user_code),children:e.jsx(b,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:F.is_returning_user?"This is your permanent login code. Keep it safe!":"This is your permanent login code. Save it for future purchases!"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{className:"font-semibold text-lg",children:"Product Codes (Send to Admin)"}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>$(!D),children:[D?e.jsx(_,{className:"w-4 h-4"}):e.jsx(y,{className:"w-4 h-4"}),D?"Hide":"Show"," Codes"]})]}),D&&e.jsx("div",{className:"space-y-3",children:F.product_codes.map((s,r)=>e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-amber-800",children:s.product_name}),e.jsx(p,{variant:"outline",className:"text-amber-700 border-amber-300",children:"Pending Approval"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"bg-background px-3 py-2 rounded border flex-1 font-mono text-lg text-amber-800",children:s.product_code}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>L(s.product_code),children:e.jsx(b,{className:"w-4 h-4"})})]})]},r))})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(v,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-semibold text-green-800",children:"Next Step: Send Product Codes"})]}),e.jsx("p",{className:"text-sm text-green-700 mb-4",children:"Send your Product Code(s) to our WhatsApp for activation. Our admin will approve your access within 24 hours."}),e.jsxs(i,{onClick:W,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"Send Product Codes via WhatsApp"]})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Purchase Summary"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Items:"}),e.jsx("span",{children:s.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:e.jsx(g,{pkrAmount:F.total_amount,size:"sm"})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Status:"}),e.jsx("span",{className:"text-amber-600",children:"Pending Admin Approval"})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(i,{variant:"outline",onClick:()=>{U(null),S({user_name:"",user_email:""})},className:"flex-1",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"New Purchase"]}),e.jsxs(i,{onClick:()=>window.location.href="/subscriptions",className:"flex-1",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"View Dashboard"]})]})]})]}):e.jsxs(t,{className:"max-w-2xl mx-auto",children:[e.jsxs(o,{children:[e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"Checkout"]}),e.jsx("p",{className:"text-muted-foreground",children:"Enter your details to complete your purchase"})]}),e.jsxs(c,{className:"space-y-6",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Order Summary"}),e.jsxs("div",{className:"space-y-2",children:[s.map((s,r)=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:s.product_name}),e.jsxs("span",{className:"text-muted-foreground ml-2",children:["(",s.subscription_type," - ",s.subscription_period,")"]})]}),e.jsx(g,{pkrAmount:s.price,size:"sm"})]},r)),e.jsxs("div",{className:"border-t pt-2 flex justify-between items-center font-semibold",children:[e.jsx("span",{children:"Total:"}),e.jsx(g,{pkrAmount:H,size:"sm"})]})]})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!f.user_name.trim()||!f.user_email.trim()){const e=A.create.validationError("Please fill in all required fields");return Y.handle(e),void I(e.message)}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f.user_email)){const e=A.create.validationError("Please enter a valid email address");return Y.handle(e),void I(e.message)}if(f.user_name.length<2||f.user_name.length>100){const e=A.create.validationError("Name must be between 2 and 100 characters");return Y.handle(e),void I(e.message)}P(!0),I("");try{const e=s.map(e=>({product_id:e.product_id,subscription_type:e.subscription_type,subscription_period:e.subscription_period,price:parseFloat(e.price.toString())}));0;const{data:r,error:t}=await j.rpc("create_simple_purchase",{p_user_name:f.user_name.trim(),p_user_email:f.user_email.trim().toLowerCase(),p_products:e,p_currency:"PKR"});if(t)throw A.create.serverError(t.message||"Database operation failed");if(!r?.success){const e=r?.error||"Failed to process purchase";throw A.create.serverError(e)}{const e={...r,user_name:f.user_name.trim(),user_email:f.user_email.trim().toLowerCase()};U(e),B({title:r.is_returning_user?"Welcome back!":"Account created!",description:r.is_returning_user?"New product codes generated for your existing account":"Your account has been created with a permanent User Code"}),a?.(e)}}catch(r){const e=Y.handle(r);I(e.message)}finally{P(!1)}},className:"space-y-4",children:[T&&e.jsx(m,{variant:"destructive",children:e.jsx(u,{children:T})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"user_name",className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"Full Name *"]}),e.jsx(l,{id:"user_name",type:"text",placeholder:"Enter your full name",value:f.user_name,onChange:e=>S(s=>({...s,user_name:e.target.value})),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"user_email",className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),"Email Address *"]}),e.jsx(l,{id:"user_email",type:"email",placeholder:"Enter your email address",value:f.user_email,onChange:e=>S(s=>({...s,user_email:e.target.value})),required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"If you're a returning customer, use the same email address to link to your existing account."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[x&&e.jsx(i,{type:"button",variant:"outline",onClick:x,className:"flex-1",children:"Cancel"}),e.jsx(i,{type:"submit",disabled:O,className:"flex-1",children:O?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Complete Purchase"]})})]})]})]})]})},P=()=>{const r=a(),{cartItems:t,getTotalPrice:o}=f(),n=t.map(e=>({product_id:e.product.id,product_name:e.product.name,subscription_type:e.product.subscription_type,subscription_period:e.product.subscription_period,price:(e.product.custom_price||e.product.price)*e.quantity}));return 0===t.length?e.jsxs(e.Fragment,{children:[e.jsx(s,{}),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-primary/5",children:e.jsx("main",{className:"flex-1 w-full py-12 px-2 sm:px-4",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-24 h-24 bg-muted rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(E,{className:"w-12 h-12 text-muted-foreground"})}),e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Your Cart is Empty"}),e.jsx("p",{className:"text-muted-foreground mb-8 max-w-md mx-auto",children:"Looks like you haven't added any products to your cart yet. Browse our tools and add some products to get started!"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(i,{onClick:()=>r("/tools"),className:"bg-gradient-to-r from-primary to-brand-teal hover:from-primary/90 hover:to-brand-teal/90 text-white",children:"Browse Tools"}),e.jsxs(i,{variant:"outline",onClick:()=>r(-1),children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Back"]})]})]})})})})]}):e.jsxs(e.Fragment,{children:[e.jsx(s,{}),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-primary/5",children:e.jsx("main",{className:"flex-1 w-full py-12 px-2 sm:px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(i,{variant:"outline",onClick:()=>r("/cart"),className:"mb-4",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Back to Cart"]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold bg-gradient-to-r from-primary to-brand-teal bg-clip-text text-transparent",children:"Checkout"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Complete your purchase"})]}),e.jsx(O,{items:n,onSuccess:e=>{r("/checkout-confirmation",{state:{result:e}})},onCancel:()=>r("/cart")})]})})})]})},T=()=>e.jsx(P,{});export{T as default};
